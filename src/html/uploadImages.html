<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <link rel="stylesheet" href="../css/header/common.css">
    <link rel="stylesheet" href="../css/uploadImages/common.css">
    <link rel="stylesheet" href="../css/footer/common.css">
</head>

<body>
    <header>
        <div class="left">
            <a href="/html/index.html" target="_self">
                <img class="logo" src="https://www.fun2repair.com/img/logo.png"></img>
            </a>
        </div>
    </header>
    <main>
        <div id="carouselExampleIndicators" class="carousel  slide" data-bs-ride="carousel">
            <div class="carousel-inner">
                <div class="carousel-item active">
                    <img class="deskTopShow" src="../images/web/page_banner_status_tracking.jpg" class="d-block w-100"
                        alt="...">
                    <img class="mobileShow" src="../images/mobile/mobile_page_banner_status_tracking.png"
                        class="d-block w-100" alt="...">
                </div>
            </div>
        </div>
        <div class="mainContainer">
            <div class="title">
                維修單申請--上傳維修件圖片與影片
                <div class="bottomLine"></div>
            </div>
            <form class="normalBlock" action="">
                <div class="col">
                    <div class="content">
                        <span class="title">照片 : </span>
                        <div class="fileGroup">
                            <label for="file-upload1" class="custom-file-upload">
                                Choose File
                            </label>
                            <input id="file-upload1" type="file" onChange="fileHandler(this)" accept="image/*"
                                multiple />
                            <div class="filename"></div>
                        </div>
                    </div>
                    <button class="greenBtn">上傳</button>
                </div>
                <div class="col">
                    <div class="content">
                        <span class="title">影片 : </span>
                        <div class="fileGroup">
                            <label for="file-upload2" class="custom-file-upload">
                                Choose File
                            </label>
                            <input id="file-upload2" type="file" onChange="fileHandler(this,'video')"
                                data-target="file-uploader" accept="video/mp4,video/x-m4v,video/*" />
                            <div class="videoName"></div>
                        </div>
                    </div>
                    <button class="garyBtn">已上傳</button>
                </div>
                <div class="displayContainer">
                    <!-- <div class="item">
                        <div class="title">照片</div>
                        <img class="close" src="../images/web/ic_popup_close.png" alt="">
                        <div class="content">
                            <img src="../images/web/page_banner_status_tracking.jpg" alt="">
                        </div>
                    </div>
                    <div class="item">
                        <div class="title">照片</div>
                        <img class="close" src="../images/web/ic_popup_close.png" alt="">
                        <div class="content">
                            <img src="../images/web/banner_image_02.png" alt="">
                        </div>
                    </div>
                    <div class="item">
                        <div class="title">照片</div>
                        <img class="close" src="../images/web/ic_popup_close.png" alt="">
                        <div class="content">
                            <img src="../images/web/banner_image_05.png" alt="">
                        </div>
                    </div> -->
                </div>
                <div class="btnContainer">
                    <input type="submit" class="orangeBtn" value="確認完畢">
                </div>
            </form>
        </div>
    </main>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
        crossorigin="anonymous"></script>
    <script>
        // submit File
        var fileArr = [];
        // 圖片預覽
        function fileHandler(e,type) {
            var result = "";
            var html = "";
            if(type !== "video"){
                if (e.files && e.files.length >= 0) {
                    for (let i = 0; i < e.files.length; ++i) {
                        var reader = new FileReader();
                        reader.onload = (readerEl) => {
                            html += `
                                <div class="item">
                                    <div class="title">照片</div>
                                    <img class="close" onClick="deleteImg(this,'${e.files.item(i).name}','${e.files.item(i)}')" src="../images/web/ic_popup_close.png" alt="">
                                    <div class="content">
                                        <img src="${readerEl.target.result}" alt="">
                                    </div>
                                </div>
                            `
                            document.querySelector(".displayContainer").innerHTML = (html);
                        };
                        reader.readAsDataURL(e.files[i]);
                        // 檔名處理
                        result += e.files.item(i).name;
                        if (i < e.files.length - 1) {
                            result += '/';
                        }
                        fileArr.push(e.files.item(i))
                    }
                    console.log("submit pic -> ",fileArr)
                }
            }else{
                result = e.files[0].name;
                console.log("submit video -> ",e.files[0])
            }
            e.nextSibling.nextElementSibling.innerText = result;
        }
        // 圖片刪除
        function deleteImg(el, fileName ,item) {
            fileArr.splice(fileArr.indexOf(item), 1);
            document.querySelector("#file-upload1").value=null;
            var filename_text = document.querySelector(".filename").innerHTML;
            filename_text = filename_text.replace(fileName,'').replace('//','/');
            
            // 去除頭部 '/'
            if(filename_text.charAt(0) == '/'){
                filename_text = filename_text.substring(1,filename_text.length)
            }
            // 去除尾部 '/'
            if(filename_text.charAt(filename_text.length - 1) == '/'){
                filename_text = filename_text.substring(0,filename_text.length - 1)
            }
           
            document.querySelector(".filename").innerHTML = filename_text;
            el.parentElement.remove();
        }
    </script>
</body>

</html>